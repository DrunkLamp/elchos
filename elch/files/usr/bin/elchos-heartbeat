#!/bin/sh
. /lib/functions/network.sh
port1=2121
port2=2122                
stats=$(sar -n DEV 1 3 | grep Average |grep eth0 | awk -F " " '{print ("\"net-rx\":" $5 ",\"net-tx\":" $6 )}')
stats=$(printf '%s,"load":%s' "${stats}" "$(cut -d\  -f1 /proc/loadavg)")
stats=$(printf '%s,"cpu":%s' "${stats}" "$(sar 1 3 | grep Average | awk -F " " '{print (100 - $8)}')")
network_get_ipaddr ip wan
echo '{"IP":"'$ip'","PORT":"'$port1'",'$stats'}'
curl -H "Content-Type: application/json" https://search.nsupdate.info/api/ping -k -XPOST -d '{"IP":"'$ip'","PORT":"'$port1'",'$stats'}'
echo
curl -H "Content-Type: application/json" https://search.nsupdate.info/api/ping -k -XPOST -d '{"IP":"'$ip'","PORT":"'$port2'",'$stats'}'
echo